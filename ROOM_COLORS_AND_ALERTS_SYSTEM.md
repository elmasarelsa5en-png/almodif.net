# 🎨 نظام الألوان الذكي والتنبيهات للشقق

## ✅ التحديثات المنفذة:

### 1️⃣ **نظام الألوان حسب الحالة**

تم تحديث ألوان الغرف لتكون واضحة ومميزة:

| الحالة | اللون | الوصف |
|--------|-------|-------|
| **متاحة** | 🟢 أخضر | الغرفة جاهزة للحجز |
| **مشغولة** | 🔴 أحمر | يوجد نزيل في الغرفة + اسم العميل |
| **خروج اليوم** | 🔴🔵 أحمر→أزرق (Gradient) | موعد خروج النزيل اليوم |
| **تحت الصيانة** | ⚪ رصاصي | الغرفة تحتاج صيانة |
| **تحتاج تنظيف** | 🟠 برتقالي | الغرفة تحتاج تنظيف |
| **محجوزة** | 🟣 بنفسجي | محجوزة ولم يصل النزيل |

---

### 2️⃣ **عرض اسم العميل بشكل بارز**

- ✅ **الغرف المشغولة** → اسم العميل يظهر في مستطيل أحمر كبير
- ✅ **الغرف خروج اليوم** → اسم العميل في gradient أحمر→أزرق
- ✅ **رقم الجوال** يظهر أسفل الاسم مباشرة
- ✅ **تصميم بارز** مع border وshadow

**مثال:**
```
┌─────────────────────┐
│ 🔴 مشغولة    101  │
│                     │
│ ┌─────────────────┐ │
│ │ 👤 محمد أحمد   │ │
│ │ 📱 0501234567  │ │
│ └─────────────────┘ │
│ +500 ر.س           │
└─────────────────────┘
```

---

### 3️⃣ **نظام فحص تلقائي للـ Checkout**

#### **كيف يعمل؟**

1. **فحص تلقائي كل دقيقة** للتحقق من تاريخ الخروج
2. **مقارنة التاريخ الحالي** مع تاريخ checkout من bookingDetails
3. **تحديث تلقائي** لحالة الغرفة من "مشغولة" → "خروج اليوم"
4. **حفظ في Firebase** تلقائياً

#### **الدوال المستخدمة:**

```typescript
// التحقق من checkout اليوم
isCheckoutToday(checkoutDate: string): boolean

// تحديث تلقائي لحالة الغرف
autoUpdateRoomStatusByCheckout(rooms: Room[]): Room[]

// الحصول على قائمة المتأخرين
getLateCheckoutRooms(rooms: Room[]): Room[]
```

---

### 4️⃣ **تنبيه بعد الساعة 2 ظهراً**

#### **متى يظهر التنبيه؟**

- ✅ عندما يكون checkout اليوم
- ✅ وتجاوزت الساعة **2:00 ظهراً** (14:00)
- ✅ والنزيل لم يغادر بعد

#### **شكل التنبيه:**

```
╔════════════════════════════════════╗
║ ⚠️ تنبيه: نزلاء متأخرين عن checkout ║
║ تأخروا عن الساعة 2 ظهراً            ║
╠════════════════════════════════════╣
║ 🔴 101 | محمد أحمد                 ║
║        📱 0501234567               ║
║        الخروج: 2025-10-29 12:00   ║
║        [اتصل الآن]                 ║
╚════════════════════════════════════╝
```

#### **المميزات:**

- 🎯 **نافذة منبثقة** في أعلى الصفحة
- 🔴 **لون أحمر→برتقالي** لافت للنظر
- 📱 **زر اتصال مباشر** لكل نزيل
- 🔄 **تحديث تلقائي** كل دقيقة
- ❌ **يمكن إغلاقها** مع إمكانية ظهورها مرة أخرى

---

### 5️⃣ **تأثيرات بصرية للغرف المتأخرة**

#### **Pulse Animation:**
```css
animate-pulse ring-4 ring-red-500
```
الغرف المتأخرة تنبض باللون الأحمر!

#### **شريط تحذير:**
```
┌─────────────────────┐
│ ⚠️ متأخر عن checkout│ ← شريط أحمر في الأعلى
├─────────────────────┤
│ 🔴 خروج اليوم  101 │
│                     │
│ 👤 محمد أحمد       │
└─────────────────────┘
```

---

## 📊 سيناريو الاستخدام الكامل:

### **صباح يوم 29 أكتوبر:**

1. ✅ النظام يفحص جميع الغرف
2. ✅ يجد غرفة 101 checkout اليوم (الساعة 12 ظهراً)
3. ✅ يحول حالتها تلقائياً → **"خروج اليوم"**
4. ✅ اللون يتحول → 🔴🔵 **أحمر→أزرق**
5. ✅ اسم العميل يظهر بشكل بارز

### **الساعة 2:05 ظهراً:**

6. ⚠️ النظام يكتشف أن الوقت تجاوز 2 ظهراً
7. ⚠️ النزيل لم يخرج بعد
8. ⚠️ **تنبيه أحمر** يظهر في أعلى الشاشة
9. ⚠️ الغرفة تنبض بـ **pulse animation**
10. ⚠️ شريط أحمر "⚠️ متأخر عن checkout" يظهر

### **بعد خروج النزيل:**

11. ✅ الموظف يضغط على الغرفة
12. ✅ يختار حالة **"تحتاج تنظيف"**
13. ✅ اللون يتحول → 🟠 **برتقالي**
14. ✅ اسم العميل يختفي
15. ✅ التنبيه يختفي تلقائياً

---

## 🔧 التحديثات التقنية:

### **ملفات تم تعديلها:**

1. **`src/lib/rooms-data.ts`**
   - إضافة type جديد: `CheckoutToday`
   - تحديث `ROOM_STATUS_CONFIG` بالألوان الجديدة
   - دوال جديدة:
     - `isCheckoutToday()`
     - `isLateCheckout()`
     - `autoUpdateRoomStatusByCheckout()`
     - `getLateCheckoutRooms()`

2. **`src/app/dashboard/rooms/page.tsx`**
   - useEffect للفحص التلقائي (كل دقيقة)
   - State للتنبيهات: `lateCheckoutRooms`, `showLateCheckoutAlert`
   - تحديث `RoomCard` مع الألوان والتأثيرات
   - نافذة التنبيه المنبثقة

3. **`src/app/dashboard/rooms/booking-dialog.tsx`**
   - تحديث الحالة من `PendingCleaning` → `CheckoutToday`

---

## 🎨 الألوان بالتفصيل:

### **الحالة: متاحة**
```css
bg-green-600  /* أخضر قوي */
```

### **الحالة: مشغولة**
```css
bg-red-600  /* أحمر قوي */
```

### **الحالة: خروج اليوم**
```css
bg-gradient-to-r from-red-500 to-blue-600  /* تدرج أحمر→أزرق */
```

### **الحالة: تحت الصيانة**
```css
bg-gray-600  /* رصاصي */
```

### **الحالة: تحتاج تنظيف**
```css
bg-orange-600  /* برتقالي */
```

### **الحالة: محجوزة**
```css
bg-purple-600  /* بنفسجي */
```

---

## 📱 تفاصيل عرض اسم العميل:

### **للغرف المشغولة:**
```tsx
<div className="bg-gradient-to-r from-red-600/90 to-red-700/90 
     backdrop-blur-sm p-2 rounded-lg border-2 border-white/30 shadow-xl">
  <p className="text-sm font-bold text-white">👤 محمد أحمد</p>
  <p className="text-xs text-white/90">📱 0501234567</p>
</div>
```

### **للغرف خروج اليوم:**
```tsx
<div className="bg-gradient-to-r from-red-600/90 to-blue-600/90 
     backdrop-blur-sm p-2 rounded-lg border-2 border-white/30 shadow-xl">
  <p className="text-sm font-bold text-white">👤 محمد أحمد</p>
  <p className="text-xs text-white/90">📱 0501234567</p>
</div>
```

---

## ⏰ جدول الفحص التلقائي:

| الوقت | الإجراء |
|-------|---------|
| **كل دقيقة** | فحص جميع الغرف |
| **00:00 صباحاً** | تحديث تلقائي للحالات |
| **14:00 ظهراً** | بداية فترة التحذير |
| **14:01 ظهراً** | ظهور التنبيهات |
| **بعد الخروج** | إخفاء التنبيهات |

---

## 🚀 المميزات الإضافية:

### **1. Responsive Design:**
- ✅ يعمل على كل الشاشات
- ✅ التنبيه responsive في الموبايل
- ✅ الألوان واضحة على كل الأجهزة

### **2. Performance:**
- ✅ فحص ذكي (لا يفحص إذا لا توجد غرف)
- ✅ تحديث فقط عند التغيير
- ✅ حفظ Firebase فقط للغرف المتغيرة

### **3. User Experience:**
- ✅ ألوان واضحة ومميزة
- ✅ اسم العميل بارز وسهل القراءة
- ✅ تنبيهات لافتة للنظر
- ✅ أزرار اتصال مباشرة

---

## 🧪 للاختبار:

### **1. اختبار الألوان:**
```
افتح: http://localhost:3000/dashboard/rooms
شاهد: الألوان الجديدة للغرف حسب الحالة
```

### **2. اختبار checkout اليوم:**
```
1. احجز غرفة
2. اجعل checkout اليوم
3. شاهد اللون يتحول لـ أحمر→أزرق
```

### **3. اختبار التنبيه:**
```
1. احجز غرفة مع checkout اليوم
2. انتظر حتى الساعة 2 ظهراً (أو غير وقت النظام)
3. شاهد التنبيه يظهر
```

### **4. اختبار الفحص التلقائي:**
```
1. افتح Console (F12)
2. شاهد: "🔍 فحص تلقائي لحالة الغرف..."
3. كل دقيقة
```

---

## 📝 ملاحظات مهمة:

1. ✅ **الفحص التلقائي** يعمل في الخلفية كل دقيقة
2. ✅ **الحفظ في Firebase** تلقائي عند التحديث
3. ✅ **التنبيه** يظهر فقط بعد الساعة 2 ظهراً
4. ✅ **الألوان** متوافقة مع الـ dark mode
5. ✅ **اسم العميل** يظهر فقط للغرف المشغولة

---

## 🎯 الخلاصة:

### **ما تم تنفيذه:**

- ✅ **نظام ألوان ذكي** حسب 6 حالات مختلفة
- ✅ **عرض اسم العميل** بشكل بارز ومميز
- ✅ **فحص تلقائي** لـ checkout كل دقيقة
- ✅ **تنبيه ذكي** بعد الساعة 2 ظهراً
- ✅ **تأثيرات بصرية** (pulse, gradient, shadows)
- ✅ **حفظ تلقائي** في Firebase

### **النتيجة:**

نظام احترافي ومتكامل لإدارة الغرف مع:
- 🎨 ألوان واضحة ومميزة
- 👤 عرض معلومات العميل بشكل بارز
- ⏰ تنبيهات ذكية في الوقت المناسب
- 🔄 تحديثات تلقائية بدون تدخل

---

**تم التنفيذ بنجاح! 🎉**
