<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø¸Ø§Ù… OTP</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 min-h-screen p-8">
    <div class="max-w-2xl mx-auto">
        <div class="bg-slate-800 rounded-xl shadow-2xl p-8 mb-6">
            <h1 class="text-3xl font-bold text-amber-400 mb-6 text-center">
                ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø¸Ø§Ù… OTP
            </h1>
            
            <!-- Ø­Ø§Ù„Ø© Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ -->
            <div class="bg-slate-700 rounded-lg p-4 mb-6">
                <h2 class="text-xl font-bold text-white mb-3">âœ… Ø­Ø§Ù„Ø© Ø®Ø¯Ù…Ø© Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨</h2>
                <div id="whatsapp-status" class="text-gray-300">
                    <p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</p>
                </div>
                <button onclick="checkWhatsAppStatus()" class="mt-3 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                    ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©
                </button>
            </div>

            <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø±Ø³Ø§Ù„ OTP -->
            <div class="bg-slate-700 rounded-lg p-4 mb-6">
                <h2 class="text-xl font-bold text-white mb-3">ğŸ“± Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚</h2>
                
                <div class="mb-4">
                    <label class="block text-amber-200 mb-2">Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ (Ù…Ø«Ø§Ù„: 0501234567)</label>
                    <input 
                        type="text" 
                        id="phone" 
                        placeholder="0501234567"
                        class="w-full bg-slate-600 border border-slate-500 text-white px-4 py-2 rounded"
                    >
                </div>

                <div class="mb-4">
                    <label class="block text-amber-200 mb-2">Ø§Ù„ÙƒÙˆØ¯ (6 Ø£Ø±Ù‚Ø§Ù…)</label>
                    <input 
                        type="text" 
                        id="code" 
                        placeholder="123456"
                        maxlength="6"
                        class="w-full bg-slate-600 border border-slate-500 text-white px-4 py-2 rounded text-center text-2xl tracking-widest"
                    >
                    <button onclick="generateRandomOTP()" class="mt-2 text-amber-300 hover:underline text-sm">
                        ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ Ø¹Ø´ÙˆØ§Ø¦ÙŠ
                    </button>
                </div>

                <div class="mb-4">
                    <label class="block text-amber-200 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø©</label>
                    <select id="type" class="w-full bg-slate-600 border border-slate-500 text-white px-4 py-2 rounded">
                        <option value="verification">Ø±Ù…Ø² ØªØ­Ù‚Ù‚ (OTP)</option>
                        <option value="password">ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±</option>
                    </select>
                </div>

                <button onclick="sendOTP()" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded font-bold">
                    Ø¥Ø±Ø³Ø§Ù„ Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨
                </button>
            </div>

            <!-- Ø§Ù„Ù†ØªÙŠØ¬Ø© -->
            <div id="result" class="hidden">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
            </div>
        </div>

        <!-- Ø±Ø§Ø¨Ø· QR Code -->
        <div class="text-center">
            <a href="http://localhost:3002/api/qr" target="_blank" 
               class="inline-block bg-amber-500 hover:bg-amber-600 text-white px-6 py-3 rounded-lg font-bold">
                ğŸ”— ÙØªØ­ QR Code Ù„Ù„Ø±Ø¨Ø·
            </a>
        </div>
    </div>

    <script>
        // ØªÙˆÙ„ÙŠØ¯ OTP Ø¹Ø´ÙˆØ§Ø¦ÙŠ
        function generateRandomOTP() {
            const otp = Math.floor(100000 + Math.random() * 900000).toString();
            document.getElementById('code').value = otp;
        }

        // ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨
        async function checkWhatsAppStatus() {
            const statusDiv = document.getElementById('whatsapp-status');
            statusDiv.innerHTML = '<p class="text-yellow-300">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</p>';
            
            try {
                const response = await fetch('http://localhost:3002/api/status');
                const data = await response.json();
                
                if (data.status === 'authenticated') {
                    statusDiv.innerHTML = `
                        <div class="text-green-400">
                            <p class="font-bold">âœ… Ù…ØªØµÙ„ Ø¨Ù†Ø¬Ø§Ø­!</p>
                            <p class="text-sm mt-1">Ø§Ù„Ø±Ù‚Ù…: ${data.phoneNumber || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</p>
                        </div>
                    `;
                } else if (data.status === 'qr') {
                    statusDiv.innerHTML = `
                        <div class="text-yellow-300">
                            <p class="font-bold">âš ï¸ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø³Ø­</p>
                            <p class="text-sm mt-1">Ø§ÙØªØ­ Ø±Ø§Ø¨Ø· QR Code ÙˆØ§Ù…Ø³Ø­Ù‡</p>
                        </div>
                    `;
                } else {
                    statusDiv.innerHTML = `
                        <div class="text-orange-300">
                            <p class="font-bold">ğŸ”„ ${data.status}</p>
                        </div>
                    `;
                }
            } catch (error) {
                statusDiv.innerHTML = `
                    <div class="text-red-400">
                        <p class="font-bold">âŒ Ø§Ù„Ø®Ø¯Ù…Ø© ØºÙŠØ± Ù…ØªØ§Ø­Ø©</p>
                        <p class="text-sm mt-1">ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ start-whatsapp-service.bat</p>
                        <p class="text-xs mt-1 text-gray-400">${error.message}</p>
                    </div>
                `;
            }
        }

        // Ø¥Ø±Ø³Ø§Ù„ OTP
        async function sendOTP() {
            const phone = document.getElementById('phone').value;
            const code = document.getElementById('code').value;
            const type = document.getElementById('type').value;
            const resultDiv = document.getElementById('result');

            if (!phone || !code) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ ÙˆØ§Ù„ÙƒÙˆØ¯');
                return;
            }

            if (code.length !== 6) {
                alert('Ø§Ù„ÙƒÙˆØ¯ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 6 Ø£Ø±Ù‚Ø§Ù…');
                return;
            }

            resultDiv.innerHTML = `
                <div class="bg-blue-500/20 border border-blue-400 rounded-lg p-4">
                    <p class="text-blue-300">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...</p>
                </div>
            `;
            resultDiv.classList.remove('hidden');

            try {
                const response = await fetch('/api/send-otp', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ phone, code, type })
                });

                const data = await response.json();

                if (data.success) {
                    resultDiv.innerHTML = `
                        <div class="bg-green-500/20 border border-green-400 rounded-lg p-4">
                            <p class="text-green-300 font-bold">âœ… ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­!</p>
                            <p class="text-green-200 text-sm mt-2">${data.message || 'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨'}</p>
                            <p class="text-gray-300 text-xs mt-2">Ø§Ù„Ø±Ù‚Ù…: ${phone}</p>
                            <p class="text-gray-300 text-xs">Ø§Ù„ÙƒÙˆØ¯: ${code}</p>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="bg-red-500/20 border border-red-400 rounded-lg p-4">
                            <p class="text-red-300 font-bold">âŒ ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</p>
                            <p class="text-red-200 text-sm mt-2">${data.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„'}</p>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="bg-red-500/20 border border-red-400 rounded-lg p-4">
                        <p class="text-red-300 font-bold">âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„</p>
                        <p class="text-red-200 text-sm mt-2">${error.message}</p>
                        <p class="text-gray-300 text-xs mt-2">ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙˆØ§Ù„Ø®Ø¯Ù…Ø©</p>
                    </div>
                `;
            }
        }

        // ÙØ­Øµ Ø§Ù„Ø­Ø§Ù„Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('load', () => {
            checkWhatsAppStatus();
            // ØªÙˆÙ„ÙŠØ¯ OTP Ø§ÙØªØ±Ø§Ø¶ÙŠ
            generateRandomOTP();
        });
    </script>
</body>
</html>
